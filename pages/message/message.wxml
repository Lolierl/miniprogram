<!--pages/message/message.wxml-->
<view class="back-button" bindtap="navigateBack">
  <image src="/image/back.png" class="back-icon"/>
</view>
<view class="container">
  <!-- 顶部显示对方昵称 -->
  <view class="header">
    <text class="nickname">{{otherUserInfo.nickName}}</text>
  </view>
 
  <!-- 消息列表 -->
  <scroll-view class="message-list" scroll-y="true">
    <block wx:for="{{chatMessages}}" wx:key="id" >
      <view class="message-container">
        <view class="message-item {{item.senderNum == currentUserNum ? 'sent' : 'received'}}">
          <text wx:if="{{item.messageType === 'text'}}" class="message-content">{{item.message}}</text>
          <!-- 如果消息是图片，则显示图片 -->
          <block wx:if="{{item.messageType === 'image'}}">
            <image class="message-image {{item.imageStatus === 'new image' && item.receiverNum === currentUserNum ? 'blurred' : ''}}" src="{{item.message}}" mode="aspectFill"  bindtap="previewImage" />
            <view wx:if="{{item.imageStatus === 'new image' && item.receiverNum === currentUserNum}}" class="exchange-button" bindtap="exchangeImage" data-messageId="{{item._id}}">Exchange</view>
          </block>
        </view>
      </view>
    </block>
  </scroll-view>




  
  <view class="wrap1"> 
  <!-- 输入框 -->
    <view>
      <input 
        class="input" 
        placeholder="Type your message..."
        bindinput="onInput"
        value="{{messageText}}" />
    </view>
  <!-- 口头禅 -->
    <view class="container1">
      <view class="but1" bind:longpress="changePhrase1" bindtap="createBubbles">{{firstChar1}}</view>
      <view id="bubbles-container"></view>
    </view>

    <view class="but2" bind:longpress="changePhrase2">
      {{firstChar2}}
    </view>
    <view class="but3" bind:longpress="changePhrase3">
      {{firstChar3}}
    </view>
    <view class="but4" bind:longpress="changePhrase4">
      {{firstChar4}}
    </view>
  
  </view>


  <!-- 底部发送按钮 -->
  <view class="footer">
    
    <view class="send-button" bindtap="sendMessage">Send</view>
    
    <view class="photo-button" bindtap="chooseImage">
      <image src="/image/photo.png" class="photo-icon"/>
      <text class="text-photo">Photo</text>
    </view>
    
  </view>
</view>